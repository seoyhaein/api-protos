version: v2

# Clean mode: 기존 gen 디렉터리 삭제 후 재생성
clean: true

# Managed Mode: 자동으로 go_package, csharp_namespace 등을 설정
managed:
  enabled: true
  disable:
    # 구글 API Protos는 자동 관리 제외
    - module: buf.build/googleapis/googleapis

    # datablock 서비스의 go_package 자동 관리 비활성화
    - path: protos/datablock/ichthys/v1
      file_option: go_package

    # syncfolders 서비스의 go_package 자동 관리 비활성화
    - path: protos/syncfolders/ichthys/v1
      file_option: go_package

 # override:
    # 필요한 경우 여기에 file_option 오버라이드 설정
    # - file_option: go_package_prefix
    #   value: github.com/yourorg/api-protos/gen/go
    # - file_option: csharp_namespace
    #   value: YourOrg.ApiProtos.Gen.CSharp

# 플러그인 정의 (서비스별 분리 생성)
plugins:
  # ─── datablock: Go 메시지 타입 생성 ────────────────────────────────
  - remote: buf.build/protocolbuffers/go:v1.36.6
    out: gen/go/datablock
    opt:
      - paths=source_relative

  # ─── datablock: Go gRPC 스텁 생성 ─────────────────────────────────
  - remote: buf.build/grpc/go:v1.5.1
    out: gen/go/datablock
    opt:
      - paths=source_relative
  
  # ─── syncfolders: Go 메시지 타입 생성 ────────────────────────────
  - remote: buf.build/protocolbuffers/go:v1.36.6
    out: gen/go/syncfolders
    opt:
      - paths=source_relative
   
  # ─── syncfolders: Go gRPC 스텁 생성 ───────────────────────────────
  - remote: buf.build/grpc/go:v1.5.1
    out: gen/go/syncfolders
    opt:
      - paths=source_relative

  # ─── (선택) C# 코드 생성 ─────────────────────────────────────────
  # - protoc_builtin: csharp
  #   protoc_path: /usr/local/bin/protoc
  #   out: gen/csharp
  #   when:
  #     include:
  #       paths:
  #         - protos/datablock/ichthys/v1/*.proto
  #         - protos/syncfolders/ichthys/v1/*.proto

# 입력 디렉터리 설정
inputs:
  - directory: protos/datablock/ichthys/v1
  - directory: protos/syncfolders/ichthys/v1
